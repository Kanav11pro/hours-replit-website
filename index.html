

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Study Master - Weekly Challenge</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

  <style>
.btn-secondary {
  background: var(--accent-color);
  color: #fff;
  border: none;
  padding: 0.6rem 1.2rem;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.3s, transform 0.2s;
  margin: 0 0.5rem;
}
.btn-secondary:hover { background: #059669; transform: translateY(-2px); }


  /* Header */
    header {
      text-align: center;
      padding: 1.5rem 1rem;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      margin-bottom: 1.5rem;
      border-radius: 0 0 20px 20px;
      position: relative;
      overflow: hidden;
    }
    header h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      color: #fff;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
      animation: slideDown var(--animation-speed) ease-out both;
    }
    header p {
      font-size: 1rem;
      color: rgba(255,255,255,0.9);
      max-width: 90%;
      margin: 0 auto;
      animation: fadeIn 1s ease 0.8s forwards;
    }
    header nav {
      margin-top: 1rem;
    }
    header nav a {
      color: #fff;
      text-decoration: none;
      font-weight: 600;
      margin: 0 0.5rem;
      transition: color var(--transition-speed);
    }
    header nav a:hover {
      color: var(--accent-color);
    }





    
  
  .previous-weeks-scroll {
  max-height: 200px;
  overflow-y: auto;
}

    /* Added new styles for improvements */
    .motivation-message {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: white;
      padding: 1rem;
      border-radius: 10px;
      margin: 1rem 0;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .previous-weeks-container {
      max-height: 200px;
      overflow-y: auto;
      margin-top: 1rem;
    }

    .daily-avg-message {
      text-align: center;
      padding: 0.8rem;
      background: rgba(255,255,255,0.2);
      border-radius: 8px;
      margin: 1rem 0;
      font-weight: 600;
    }
    
    :root {
      --primary-color: #6366f1;
      --secondary-color: #8b5cf6;
      --accent-color: #10b981;
      --danger-color: #ef4444;
      --bg-gradient: linear-gradient(135deg, #1e3c72, #2a5298);
      --card-bg: rgba(255,255,255,0.9);
      --shadow-color: rgba(0,0,0,0.1);
      --text-color: #1a202c;
      --small-text: 0.9rem;
    }
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif; }
    body {
      background: var(--bg-gradient);
      color: var(--text-color);
      font-size: var(--small-text);
      line-height:1.6;
      padding:1rem;
      min-height:100vh;
    }
    .container { max-width:1200px; margin:0 auto; }

    header {
      text-align:center; padding:1.5rem 1rem;
      background:rgba(255,255,255,0.1); backdrop-filter:blur(10px);
      border-radius:0 0 20px 20px; margin-bottom:1.5rem;
      animation:slideDown 0.6s ease-out both;
    }
    header h1 { font-size:2.5rem; color:#fff; text-shadow:0 2px 4px rgba(0,0,0,0.2); }
    header p  { font-size:1rem; color:rgba(255,255,255,0.9); }

    main {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
      gap:1.5rem;
    }
    .card {
      background:var(--card-bg);
      padding:1.5rem;
      border-radius:15px;
      box-shadow:0 6px 20px var(--shadow-color);
      backdrop-filter:blur(10px);
      transition:transform 0.3s;
      animation:fadeInUp 0.6s ease both;
    }
    .card:hover { transform:translateY(-5px); }
    h2 { text-align:center; color:var(--primary-color); margin-bottom:1rem; }

    /* Progress */
    .progress-bar-container {
      width:100%; background:#e2e8f0; border-radius:25px; height:20px; overflow:hidden;
    }
    .progress-bar-fill {
      height:100%; width:0; background:var(--primary-color); transition:width 1s ease-out;
    }
    .progress-bar-text {
      text-align:center; margin-top:0.5rem; font-weight:bold; color:var(--primary-color);
    }

    /* Countdown & Motivation */
    .countdown { text-align:center; color:var(--accent-color); margin-top:0.5rem; }
    .motivation-message {
      text-align:center; padding:0.6rem; border-radius:10px; margin-top:1rem;
      display:flex; justify-content:center; align-items:center; gap:0.5rem;
    }
    .success { background:#dcfce7; color:#166534; }
    .warning { background:#fef3c7; color:#92400e; }

    /* Forms */
    form { display:grid; gap:1rem; }
    .input-group { display:flex; flex-direction:column; gap:0.5rem; }
    input[type=date], input[type=number] {
      padding:0.6rem; border:2px solid #e2e8f0; border-radius:8px;
      font-size:var(--small-text); transition:border-color 0.3s;
    }
    input:disabled { background:#f0f0f0; }
    input:focus {
      outline:none; border-color:var(--primary-color);
      box-shadow:0 0 0 3px rgba(99,102,241,0.3);
    }
    button {
      background:var(--primary-color); color:#fff; border:none;
      padding:0.6rem; border-radius:8px; font-weight:600; font-size:var(--small-text);
      cursor:pointer; transition:transform 0.2s, background 0.3s;
    }
    button:disabled { background:#ccc; cursor:not-allowed; }
    button:hover:not(:disabled) { background:var(--secondary-color); transform:translateY(-2px); }

    /* Table */
    .sessions-table-wrapper { max-height:200px; overflow-y:auto; margin-top:1rem; }
    table { width:100%; border-collapse:collapse; }
    th,td {
      padding:0.6rem; border-bottom:1px solid #e2e8f0; font-size:var(--small-text);
    }
    th { background:#f8fafc; }
    td.editable { cursor:pointer; }
    tr:hover { background:rgba(0,0,0,0.03); }
    .delete-btn {
      color:var(--danger-color); cursor:pointer; font-size:1rem; transition:color 0.2s;
    }
    .delete-btn:hover { color:#b91c1c; }

    /* Dashboard */
    .dashboard-header {
      display:flex; align-items:center; justify-content:center; gap:1rem;
      margin-bottom:1rem;
    }
    .dashboard-header button {
      background:none; border:2px solid var(--primary-color);
      color:var(--primary-color); border-radius:50%;
      width:32px; height:32px; font-size:1.1rem;
      line-height:0; cursor:pointer; transition:background 0.2s, color 0.2s;
    }
    .dashboard-header button:disabled {
      border-color:#ccc; color:#ccc; cursor:not-allowed;
    }
    .dashboard-header button:hover:not(:disabled) {
      background:var(--primary-color); color:#fff;
    }
    .dashboard-week-label {
      font-size:1rem; font-weight:600;
    }
    .insights {
      display:flex; flex-wrap:wrap; gap:1rem; justify-content:center;
      margin-bottom:1rem;
    }
    .insight-box {
      background:rgba(0,0,0,0.04); padding:0.8rem; border-radius:8px;
      flex:1 1 120px; text-align:center; font-size:var(--small-text);
    }

    /* Charts */
    .chart-container { position:relative; width:100%; height:180px; margin-top:1rem; }

    /* Previous Weeks */
    .previous-week-card {
      background:var(--card-bg); padding:0.8rem; border-radius:8px;
      box-shadow:0 4px 15px var(--shadow-color); margin-top:0.8rem;
      font-size:var(--small-text);
    }

    /* Animations */
    @keyframes fadeInUp { from{opacity:0;transform:translateY(20px);} to{opacity:1;transform:translateY(0);} }
    @keyframes slideDown { from{opacity:0;transform:translateY(-30px);} to{opacity:1;transform:translateY(0);} }

    /* add these to your existing <style> */
.btn {
  background: var(--primary-color);
  color: #fff;
  border: none;
  padding: 0.6rem 1.2rem;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.3s, transform 0.2s;
  margin: 0 0.5rem;
}
.btn:hover { background: var(--secondary-color); transform: translateY(-2px); }

  </style>
</head>
<body>


  <!-- Previous HTML structure remains same until script section -->
  <div class="container">
   <header>
      <h1>üìö Study Master</h1>
      <p>Welcome, User! Conquer your weekly study challenge.</p>
      <nav>
        <a href='https://exam-ace.netlify.app/prepometer'>Homepage</a>
      </nav>
    </header>
    <main>

      <!-- Weekly Progress (always current week) -->
      <section id="challenge-overview" class="card">
        <h2>Weekly Progress</h2>
        <p id="week-range"></p>
        <div class="progress-bar-container">
          <div id="progress-bar-fill" class="progress-bar-fill"></div>
        </div>
        <div id="progress-bar-text" class="progress-bar-text">0 hrs / 0 hrs</div>
        <div class="countdown" id="countdown-timer">Time left: --d --h --m --s</div>
        <div id="motivation-message" class="motivation-message"><span>üéØ Keep it up!</span></div>
      </section>

      <!-- Add Session -->
      <section id="entry-form" class="card">
        <h2>Add Study Session</h2>
        <form id="study-form">
          <div class="input-group">
            <label for="study-date">Date</label>
            <input type="date" id="study-date" required>
          </div>
          <div class="input-group">
            <label>Duration</label>
            <div style="display:flex;gap:0.5rem;flex-wrap:wrap;">
              <input type="number" id="hours" placeholder="Hours" min="0" required style="flex:1">
              <input type="number" id="minutes" placeholder="Minutes" min="0" max="59" style="flex:1">
            </div>
          </div>
          <button type="submit">‚ûï Add Session</button>
        </form>
      </section>

      <!-- Weekly Target -->
      <section id="target-update" class="card">
        <h2>Weekly Target</h2>
        <form id="target-form">
          <div class="input-group">
            <label for="target-hours">Target Hours</label>
            <input type="number" id="target-hours" min="1" required>
          </div>
          <button type="submit" id="target-btn">üéØ Set Target</button>
        </form>
        <p id="discipline-message" style="margin-top:0.4rem;color:#555;font-size:var(--small-text)"></p>
      </section>

      <!-- Sessions Table -->
      <section id="entries-list" class="card">
        <h2>Study Sessions</h2>
        <div class="sessions-table-wrapper">
          <table id="entries-table">
            <thead>
              <tr><th>Date</th><th>Duration</th><th>Action</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Dashboard & History -->
      <section id="dashboard" class="card">
        <div class="dashboard-header">
          <button id="prev-week">‚óÄÔ∏è</button>
          <div id="dashboard-week-label" class="dashboard-week-label">Week: --</div>
          <button id="next-week">‚ñ∂Ô∏è</button>
        </div>

        <div class="insights">
          <div class="insight-box">
            <strong>Avg hrs/day</strong>
            <div id="avg-hours">0.0</div>
          </div>
          <div class="insight-box">
            <strong>Best Day</strong>
            <div id="best-day">‚Äî</div>
          </div>
          <div class="insight-box">
            <strong>Sessions</strong>
            <div id="session-count">0</div>
          </div>
          <div class="insight-box">
            <strong>Target Achieved?</strong>
            <div id="target-achieved">No</div>
          </div>
        </div>

        <div class="chart-container"><canvas id="barChart"></canvas></div>
        <div class="chart-container"><canvas id="sparklineChart"></canvas></div>

        <h2 style="margin-top:1.2rem;font-size:1.1rem;">Previous Weeks</h2>
        <div id="previous-weeks-container"></div>
      </section>

    </main> 
  </div>


  <script>
// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
// Utility: get local ‚ÄúYYYY-MM-DD‚Äù string
function todayISO() {
  const now = new Date();
  now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
  return now.toISOString().split("T")[0];
}

// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
// Storage & State
const STORAGE_KEY = "studyChallengeData";
const TARGETS_KEY = "weeklyTargets";
let weekOffset = 0;

// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
// Helpers
function parseLocalDate(s) {
  const [y, m, d] = s.split("-").map(Number);
  return new Date(y, m - 1, d);
}
function formatDate(d) {
  return d.getFullYear() + "-" + 
    String(d.getMonth() + 1).padStart(2, "0") + "-" + 
    String(d.getDate()).padStart(2, "0");
}
function getEntries() {
  return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
}
function saveEntries(arr) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
}
function getWeeklyTargets() {
  return JSON.parse(localStorage.getItem(TARGETS_KEY) || "{}");
}
function saveWeeklyTargets(map) {
  localStorage.setItem(TARGETS_KEY, JSON.stringify(map));
}
function getWeekRange(offset = 0) {
  const now = new Date();
  const day = now.getDay() || 7;
  const mon = new Date(now);
  mon.setDate(now.getDate() - day + 1 + offset * 7);
  mon.setHours(0, 0, 0, 0);
  const sun = new Date(mon);
  sun.setDate(mon.getDate() + 6);
  sun.setHours(23, 59, 59, 999);
  return { monday: mon, sunday: sun };
}
function getWeeklyData(offset = 0) {
  const { monday, sunday } = getWeekRange(offset);
  return getEntries().filter(e => {
    const d = parseLocalDate(e.date);
    return d >= monday && d <= sunday;
  });
}
function getWeeklyTarget(offset = 0) {
  const map = getWeeklyTargets();
  const key = formatDate(getWeekRange(offset).monday);
  const rec = map[key];
  if (rec && typeof rec === "object") return rec.target;
  return rec || 70;
}
function setWeeklyTarget(val) {
  const map = getWeeklyTargets();
  const key = formatDate(getWeekRange(0).monday);
  let rec = map[key];
  if (!rec || typeof rec !== "object") rec = { target: rec || 70, changes: 0 };
  rec.target = val;
  rec.changes = (rec.changes || 0) + 1;
  map[key] = rec;
  saveWeeklyTargets(map);
}
function canChangeTarget() {
  const map = getWeeklyTargets();
  const key = formatDate(getWeekRange(0).monday);
  const rec = map[key];
  return !(rec && rec.changes >= 3);
}
function targetChangeCount() {
  const map = getWeeklyTargets();
  const key = formatDate(getWeekRange(0).monday);
  const rec = map[key];
  return rec && rec.changes ? rec.changes : 0;
}
// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
// Weekly Progress Card
function updateWeeklyCard() {
  const { monday, sunday } = getWeekRange(0);
  document.getElementById("week-range").textContent =
    `Week: ${formatDate(monday)} to ${formatDate(sunday)}`;

  // total hours this week
  const total = getWeeklyData(0).reduce((s, e) =>
    s + e.hours + (e.minutes || 0) / 60, 0
  );

  // progress bar
  const target = getWeeklyTarget(0);
  const pct = Math.min((total / target) * 100, 100);
  document.getElementById("progress-bar-fill").style.width = pct + "%";
  document.getElementById("progress-bar-text").textContent =
    `${total.toFixed(1)} hrs / ${target} hrs`;

  // countdown timer
  const now = new Date();
  let diff = Math.max(sunday - now, 0);
  const d = Math.floor(diff / 864e5),
        h = Math.floor((diff % 864e5) / 36e5),
        m = Math.floor((diff % 36e5) / 6e4),
        s = Math.floor((diff % 6e4) / 1e3);
  document.getElementById("countdown-timer").textContent =
    `Time left: ${d}d ${h}h ${m}m ${s}s`;

  // daily‚Äëavg needed for rest of week
  const hoursLeft = Math.max((sunday - now) / 36e5, 0);
  const daysLeft = Math.ceil(hoursLeft / 24);
  const remaining = Math.max(target - total, 0);
  const dailyAvg = daysLeft > 0 ? (remaining / daysLeft).toFixed(1) : 0;

  // motivation + daily‚Äëavg display
  const msgEl = document.getElementById("motivation-message");
  msgEl.innerHTML = `
    <div class="daily-avg-message">
      ${dailyAvg > 0 
         ? `üìÖ Daily target: ${dailyAvg} hrs/day` 
         : 'üéâ Great work this week!'}
    </div>
    <div class="status-message">
      ${now > sunday
         ? (total >= target 
             ? 'üéâ Success! You met your target!' 
             : 'üòï Not quite there. Keep pushing!')
         : 'üéØ Keep it up! You got this!'}
    </div>
  `;

  // ‚Äî only fire confetti once per week ‚Äî
  const weekKey     = formatDate(monday);              // e.g. "2025-05-04"
  const firedKey    = `confettiFired_${weekKey}`;      // unique per week
  if (total >= target && now <= sunday && !localStorage.getItem(firedKey)) {
    confetti();
    localStorage.setItem(firedKey, "1");
  }

  // Target input
  const input = document.getElementById("target-hours");
  const btn = document.getElementById("target-btn");
  const info = document.getElementById("discipline-message");
  const changes = targetChangeCount();

  if (document.activeElement !== input) input.value = target;
  if (changes >= 3) {
    input.disabled = true;
    btn.disabled = true;
    info.textContent = `üîí Target changed ${changes}/3 ‚Äî locked for this week.`;
  } else {
    input.disabled = false;
    btn.disabled = false;
    info.textContent = `Target changes used: ${changes}/3`;
  }
}

// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
// Sessions Table
function renderEntriesTable() {
  const tbody = document.querySelector("#entries-table tbody");
  tbody.innerHTML = "";

  getEntries()
    .sort((a, b) => parseLocalDate(b.date) - parseLocalDate(a.date))
    .forEach((e) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${e.date}</td>
        <td>${e.hours}h ${e.minutes || 0}m</td>
        <td><span class="delete-btn">üóëÔ∏è</span></td>
      `;

      tr.querySelector(".delete-btn").onclick = () => {
        if (!confirm("Are you sure you want to delete this session?")) return;
        // Filter out the entry *by its date* (and minutes/hours if you prefer)
        const updated = getEntries().filter(x => x.date !== e.date);
        saveEntries(updated);
        refreshAll();
      };

      tbody.appendChild(tr);
    });
}

// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
// Dashboard
let barChart, sparkChart;
function updateDashboard() {
  const { monday, sunday } = getWeekRange(weekOffset);
  document.getElementById("dashboard-week-label").textContent = 
    `Week: ${formatDate(monday)} to ${formatDate(sunday)}`;

  const days = [...Array(7)].map((_, i) => {
    const d = new Date(monday);
    d.setDate(d.getDate() + i);
    return formatDate(d);
  });
  const data = days.map(day =>
    getEntries().reduce((s, e) => 
      s + ((e.date === day) ? e.hours + (e.minutes || 0) / 60 : 0), 0
    )
  );

  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
// Insights
const total = data.reduce((a, b) => a + b, 0);

// determine how many days to average over
let daysCount;
if (weekOffset === 0) {
  // in the current week: days passed so far (Monday=1 ‚Ä¶ Sunday=7)
  const today = new Date();
  const dayIdx = today.getDay() || 7; // Sunday‚Üí7
  daysCount = dayIdx;
} else {
  // full week for past weeks
  daysCount = 7;
}

document.getElementById("avg-hours").textContent =
  (total / daysCount).toFixed(1);

document.getElementById("session-count").textContent =
  data.filter(v => v > 0).length;

document.getElementById("target-achieved").textContent =
  weekOffset === 0
    ? (total >= getWeeklyTarget(0) ? "Yes" : "No")
    : "‚Äî";

let bestDay = "‚Äî", bestVal = 0;
days.forEach((d, idx) => {
  if (data[idx] > bestVal) {
    bestVal = data[idx];
    bestDay = d;
  }
});
document.getElementById("best-day").textContent =
  bestDay === "‚Äî"
    ? "‚Äî"
    : `${bestDay} (${bestVal.toFixed(1)}h)`;

  // Bar chart
  if (barChart) barChart.destroy();
  barChart = new Chart(
    document.getElementById("barChart"),
    {
      type: "bar",
      data: { 
        labels: days, 
        datasets: [{ 
          label: "Hours", 
          data, 
          backgroundColor: getComputedStyle(document.documentElement)
            .getPropertyValue("--primary-color").trim() 
        }] 
      },
      options: { 
        scales: { y: { beginAtZero: true } }, 
        responsive: true 
      }
    }
  );

  // Sparkline chart
  if (sparkChart) sparkChart.destroy();
  sparkChart = new Chart(
    document.getElementById("sparklineChart"),
    {
      type: "line",
      data: { 
        labels: days, 
        datasets: [{
          data,
          fill: true,
          tension: 0.4,
          borderColor: '#8b5cf6',
          backgroundColor: 'rgba(139, 92, 246, 0.2)',
          borderWidth: 2,
          pointRadius: 4,
          pointBackgroundColor: '#8b5cf6',
          pointHoverRadius: 6
        }]
      },
      options: { 
        plugins: { legend: { display: false } }, 
        scales: { x: { display: false }, y: { display: false } }, 
        responsive: true,
        interaction: {
          mode: 'nearest',
          intersect: false
        }
      }
    }
  );

  document.getElementById("next-week").disabled = (weekOffset === 0);
}

// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
// Previous Weeks
function renderPreviousWeeks() {
  const cont = document.getElementById("previous-weeks-container");
  cont.innerHTML = '<div class="previous-weeks-scroll"></div>';
  const scrollCont = cont.querySelector('.previous-weeks-scroll');

  const groups = {};
  getEntries().forEach(e => {
    const d = parseLocalDate(e.date), day = d.getDay() || 7;
    const mon = new Date(d);
    mon.setDate(d.getDate() - (day - 1));
    const key = formatDate(mon);
    (groups[key] || (groups[key] = [])).push(e);
  });

  const { monday: curMon } = getWeekRange(0);
  Object.keys(groups).sort().reverse().forEach(ws => {
    const mon = parseLocalDate(ws);
    if (mon < curMon) {
      const hrs = groups[ws].reduce((s, e) => s + e.hours + (e.minutes || 0)/60, 0);
      const sun = new Date(mon);
      sun.setDate(mon.getDate() + 6);
      const card = document.createElement("div");
      card.className = "previous-week-card";
      card.innerHTML = `
        <h3>Week: ${ws} to ${formatDate(sun)}</h3>
        <p>Total: ${hrs.toFixed(1)} hrs</p>
      `;
      scrollCont.appendChild(card);
    }
  });
}

// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
// Refresh All
function refreshAll() {
  updateWeeklyCard();
  renderEntriesTable();
  updateDashboard();
  renderPreviousWeeks();
}

// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
// Event Listeners
document.getElementById("study-form").addEventListener("submit", e => {
  e.preventDefault();
  const date = document.getElementById("study-date").value;
  const hrs = Number(document.getElementById("hours").value);
  const mins = Number(document.getElementById("minutes").value) || 0;
  if (!date) return alert("Please select a date.");
  
  const arr = getEntries();
  const ex = arr.find(x => x.date === date);
  if (ex) {
    ex.hours += hrs;
    ex.minutes = (ex.minutes || 0) + mins;
    if (ex.minutes >= 60) {
      ex.hours += Math.floor(ex.minutes / 60);
      ex.minutes %= 60;
    }
  } else {
    arr.push({ date, hours: hrs, minutes: mins });
  }
  saveEntries(arr);
  e.target.reset();
  document.getElementById("study-date").value = todayISO();
  refreshAll();
});

document.getElementById("target-form").addEventListener("submit", e => {
  e.preventDefault();
  if (!canChangeTarget()) return;
  const t = Number(document.getElementById("target-hours").value);
  if (t < 1) return alert("Target must be at least 1 hour.");
  setWeeklyTarget(t);
  updateWeeklyCard();
});

document.getElementById("prev-week").addEventListener("click", () => {
  weekOffset--;
  refreshAll();
});
document.getElementById("next-week").addEventListener("click", () => {
  if (weekOffset < 0) weekOffset++;
  refreshAll();
});

// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
// Auto-update date
(function autoRolloverDate(){
  const dateInput = document.getElementById("study-date");
  setInterval(() => {
    if (dateInput.value !== todayISO()) {
      dateInput.value = todayISO();
    }
  }, 60 * 1000);
})();

    
// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
// Init
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("study-date").value = todayISO();
  refreshAll();
  setInterval(updateWeeklyCard, 1000);
});




</script>
</body>
</html>
